
# DBClientFiles.NET

A blazing-fast DBC & DB2 reader for World of Warcraft's serialized database format.

## Usage

DBClientFiles.NET exposes three collection types:

 - `StorageList<T>` and `StorageList<TKey, T>`
 - `StorageDictionary<TKey, T>` 
 - `StorageEnumerable<T>`

Each exposed type requires `T : class, new()` and `TKey : struct`, and is constructed with `System.IO.Stream` and optionally `StorageOptions` instances. If `StorageOptions` is not provided, the library automatically uses `StorageOptions.Default`.

As well as being collections, these types implement `IStorage`, which exposes metadata information about the file that was deserialized, such as **signature**, **table hash** and **layout hash**. 

## Supported file types

|Signature|WDBC|WDB2|WDB3|WDB4|WDB5|WDB6|WDC1|WDC2|
|--|--|--|--|--|--|--|--|--|
|Read|:heavy_check_mark:|:heavy_check_mark:|:x:|:x:|:heavy_check_mark:|:heavy_check_mark:|:heavy_check_mark:|:heavy_check_mark:|
|Write|:x:|:x:|:x:|:x:|:x:|:x:|:x:|:x:|

## Attributes

### `CardinalityAttribute`

This attribute is used to indicate the size of an array *field* or *property*. Behavior depends on the file format:
- For **WDBC** and **WDB2**: this attribute is required.
- For **WDB5** and **WDB6**: the library is able to guess proper array sizes for the given members **except** the last one.
- For **WDC1** and **WDC2**: the library is able to guess proper array size for all given members.

If you don't know what you should be doing, decorate your arrays.

### `IgnoreAttribute`

This attribute is used to indicate that a field or property is to be ignored by the library. It is **redundant** as the library already does sanity checks and **ignores** `readonly` fields and properties without setter.

### `IndexAttribute`

This attribute is used to decorate the member of a record that is it's key. Behavior varies depending on the file format:
- For **WDBC** and **WDB2** : If `IndexAttribute` is lacking, the first member is assumed to be the key.
- For **WDB5** and higher: This attribute is considered redundant as files already identify their index column.

## API

### `StorageEnumerable<T>`

- `public StorageEnumerable(Stream fileStream)`
- `public StorageEnumerable(Stream fileStream, StorageOptions options)`

If `StorageOptions` is not provided, `StorageOptions.Default` is used instead.

### `StorageList<T>`

- `public StorageList(Stream dataStream)`
- `public StorageList(Stream dataStream, StorageOptions options)`

If `StorageOptions` is not provided, `StorageOptions.Default` is used instead.

### `StorageDictionary<TKey, T>`

- `public StorageDictionary(Stream dataStream, StorageOptions options, Func<TValue, TKey> keyGetter)`
- `public StorageDictionary(Stream dataStream, Func<TValue, TKey> keyGetter)`
- `public StorageDictionary(Stream dataStream)`
- `public StorageDictionary(Stream dataStream, StorageOptions options)`

Creates an instance of `StorageDictionary<TKey, T>` given the provided data stream and options.
:warning: `keyGetter` is used to extract the key from the record and use it as this container's key. It has **nothing** to do with the member that is flagged as index in the file (see `IndexAttribute`). :warning:

If you use one of the constructors not involving `keyGetter`, that function is autogenerated, targetting the member decorated with `IndexAttribute`. If your declared key type mismatches the one found when deserializing, an exception will be thrown.

### StorageOptions

    public sealed class StorageOptions
    {
    	public MemberTypes MemberType { get; set; } = MemberTypes.Property;
    	public LoadMask LoadMask { get; set; } = LoadMask.Records;
    
    	public bool InternStrings { get; set; } = true;
    	public bool KeepStringTable { get; set; } = false;
    
    	/// <summary>
    	/// If set to to <code>true</code>, the stream used as source will be copied to memory before being used.
    	/// This is set to true by default for anything but MemoryStream.
    	/// </summary>
    	public bool CopyToMemory { get; set; } = false;
    
    	public static StorageOptions Default { get; }
    }

